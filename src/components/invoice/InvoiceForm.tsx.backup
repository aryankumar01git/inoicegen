import React, { useState, useEffect } from 'react';
import { Plus, Trash2, Printer, Download, RefreshCw } from 'lucide-react';
import { pdf } from '@react-pdf/renderer';
import { Button } from '../ui/Button';
import { Input } from '../ui/Input';
import type { Invoice, InvoiceItem, PaymentDetails, CustomerDetails, InvoiceStatus, ShopSettings, InventoryItem } from '../../lib/types';
import { calculateItemAmount, formatCurrency } from '../../lib/utils';
import { InvoicePDF } from './InvoicePDF';
import { getInventoryItems } from '../../lib/firestore';
import { AnimatedBackground } from '../effects/AnimatedBackground';

const initialItem: InvoiceItem = {
    id: '',
    name: '',
    quantity: 1,
    rate: 0,
    amount: 0,
    gst: 0,
    discount: 0
};

const initialPayment: PaymentDetails = {
    paidAmount: 0,
    paymentMode: 'CASH',
    dueDate: ''
};

interface InvoiceFormProps {
    settings: ShopSettings;
}


export const InvoiceForm: React.FC<InvoiceFormProps> = ({ settings }) => {
    const [customer, setCustomer] = useState<CustomerDetails>({ name: '', address: '', gstin: '', mobile: '' });
    const [items, setItems] = useState<InvoiceItem[]>([{ ...initialItem, id: '1' }]);
    const [payment, setPayment] = useState<PaymentDetails>(initialPayment);
    const [previousBalance, setPreviousBalance] = useState<number>(0);
    const [invoiceDate, setInvoiceDate] = useState(new Date().toISOString().split('T')[0]);
    const [invoiceNo, setInvoiceNo] = useState('INV-001');
    const [isClient, setIsClient] = useState(false);
    const [isGeneratingPdf, setIsGeneratingPdf] = useState(false);
    const [suggestions, setSuggestions] = useState<{ [key: number]: InventoryItem[] }>({});
    const [inventory, setInventory] = useState<InventoryItem[]>([]);
    const [selectedSuggestionIndex, setSelectedSuggestionIndex] = useState(-1);

    // Load inventory from Firebase on mount
    useEffect(() => {
        const loadInventory = async () => {
            try {
                const items = await getInventoryItems();
                setInventory(items);
                console.log('Inventory loaded:', items.length, 'items');
            } catch (error) {
                console.error('Error loading inventory:', error);
            }
        };
        loadInventory();
    }, []);

    useEffect(() => {
        setIsClient(true);
    }, []);

    // Calculations
    const subTotal = items.reduce((sum, item) => sum + item.amount, 0);
    const totalGST = items.reduce((sum, item) => sum + (item.amount * ((item.gst || 0) / 100)), 0);
    const grandTotal = Math.round(subTotal + totalGST);
    const totalDue = grandTotal + previousBalance - payment.paidAmount;

    const status: InvoiceStatus = totalDue <= 0 ? 'PAID' : (payment.paidAmount > 0 ? 'PARTIAL' : 'DUE');

    const currentInvoice: Invoice = {
        invoiceNo,
        date: invoiceDate,
        customerDetails: customer,
        items,
        paymentDetails: payment,
        previousBalance,
        roundOff: 0,
        grandTotal,
        status,
        createdAt: new Date(),

    };

    const handleItemChange = (index: number, field: keyof InvoiceItem, value: any) => {
        const newItems = [...items];
        newItems[index] = { ...newItems[index], [field]: value };

        // Autosuggest Logic
        if (field === 'name') {
            console.log('ðŸ” Typing in name field:', value);

            if (value.length > 1) {
                const matches = inventory.filter(item =>
                    item.name.toLowerCase().includes(value.toLowerCase())
                );
                console.log('âœ… Matches found:', matches);
                setSuggestions(prev => ({ ...prev, [index]: matches }));
                setSelectedSuggestionIndex(-1); // Reset selection on typing
            } else {
                setSuggestions(prev => {
                    const next = { ...prev };
                    delete next[index];
                    return next;
                });
                setSelectedSuggestionIndex(-1);
            }
        }

        // Recalculate amount if relevant fields change
        if (['quantity', 'rate', 'discount'].includes(field)) {
            const qty = field === 'quantity' ? Number(value) : newItems[index].quantity;
            const rate = field === 'rate' ? Number(value) : newItems[index].rate;
            const disc = field === 'discount' ? Number(value) : newItems[index].discount;
            newItems[index].amount = calculateItemAmount(qty, rate, disc);
        }

        setItems(newItems);
    };

    const selectSuggestion = (index: number, inventoryItem: InventoryItem) => {
        const newItems = [...items];
        newItems[index] = {
            ...newItems[index],
            name: inventoryItem.name,
            rate: inventoryItem.rate,
            gst: inventoryItem.gst ?? 0,
            amount: calculateItemAmount(newItems[index].quantity, inventoryItem.rate, newItems[index].discount)
        };
        setItems(newItems);
        setSuggestions(prev => {
            const next = { ...prev };
            delete next[index];
            return next;
        });
        setSelectedSuggestionIndex(-1);
    };

    const handleKeyDown = (e: React.KeyboardEvent, index: number) => {
        const currentSuggestions = suggestions[index] || [];
        if (currentSuggestions.length === 0) return;

        if (e.key === 'ArrowDown') {
            e.preventDefault();
            setSelectedSuggestionIndex(prev =>
                prev < currentSuggestions.length - 1 ? prev + 1 : prev
            );
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            setSelectedSuggestionIndex(prev => prev > 0 ? prev - 1 : -1);
        } else if (e.key === 'Enter' && selectedSuggestionIndex >= 0) {
            e.preventDefault();
            selectSuggestion(index, currentSuggestions[selectedSuggestionIndex]);
        }
    };

    // Global Keyboard Shortcuts
    useEffect(() => {
        const handleGlobalKeyDown = (e: KeyboardEvent) => {
            if (e.altKey) {
                switch (e.key.toLowerCase()) {
                    case 'n':
                        e.preventDefault();
                        handleClear();
                        break;
                    case 'a':
                        e.preventDefault();
                        addItem();
                        break;
                    case 'p':
                        e.preventDefault();
                        // Trigger print logic (using the first available print method or just showing alert if not ready)
                        // For now, let's trigger the direct print if client is ready
                        if (isClient) {
                            // Since we don't have aria-label, we can't easily click it. 
                            // But we can call handleThermalPrint as a fallback or just log for now.
                            // Better: Call handleThermalPrint('58mm') as a default quick print
                            handleThermalPrint('58mm');
                        }
                        break;
                    case 'd':
                        e.preventDefault();
                        // Trigger PDF download
                        const downloadBtn = document.querySelector('a[download]');
                        if (downloadBtn instanceof HTMLElement) downloadBtn.click();
                        break;
                    case 's':
                        e.preventDefault();
                        handleExportCSV();
                        break;
                }
            }
        };

        window.addEventListener('keydown', handleGlobalKeyDown);
        return () => window.removeEventListener('keydown', handleGlobalKeyDown);
    }, [isClient, items, customer, payment, invoiceNo]); // Dependencies for actions

    const addItem = () => {
        setItems([...items, { ...initialItem, id: Date.now().toString() }]);
    };

    const removeItem = (index: number) => {
        if (items.length > 1) {
            setItems(items.filter((_, i) => i !== index));
        }
    };

    const handleExportCSV = () => {
        const headers = ['Invoice No', 'Date', 'Customer', 'Mobile', 'Grand Total', 'Status'];
        const row = [
            invoiceNo,
            invoiceDate,
            customer.name,
            customer.mobile,
            grandTotal,
            status
        ];

        const csvContent = "data:text/csv;charset=utf-8,"
            + headers.join(",") + "\\n" + row.join(",");

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `invoice_${invoiceNo}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    };

    const handleWhatsApp = async () => {
        if (!customer.mobile) {
            alert('Please enter customer mobile number');
            return;
        }

        // Download PDF first
        try {
            const { pdf } = await import('@react-pdf/renderer');
            const blob = await pdf(<InvoicePDF invoice={currentInvoice} settings={settings} />).toBlob();
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `invoice-${invoiceNo}.pdf`;
            link.click();
            URL.revokeObjectURL(url);
        } catch (error) {
            console.error('PDF generation error:', error);
        }

        // Then open WhatsApp
        setTimeout(() => {
            let message = `Hello ${customer.name},\\n\\nHere is your invoice ${invoiceNo} for â‚¹${grandTotal}.\\n\\nThank you for shopping with ${settings.shopName}!`;
            if (settings.websiteUrl) {
                message += `\\n\\nVisit us: ${settings.websiteUrl}`;
            }
            const waUrl = `https://wa.me/91${customer.mobile}?text=${encodeURIComponent(message)}`;
            window.open(waUrl, '_blank');
        }, 500);
    };

    const handleTelegram = async () => {
        // Download PDF first
        try {
            const { pdf } = await import('@react-pdf/renderer');
            const blob = await pdf(<InvoicePDF invoice={currentInvoice} settings={settings} />).toBlob();
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `invoice-${invoiceNo}.pdf`;
            link.click();
            URL.revokeObjectURL(url);
        } catch (error) {
            console.error('PDF generation error:', error);
        }

        // Then open Telegram
        setTimeout(() => {
            let message = `Hello ${customer.name},\\n\\nHere is your invoice ${invoiceNo} for â‚¹${grandTotal}.\\n\\nThank you for shopping with ${settings.shopName}!`;
            if (settings.websiteUrl) {
                message += `\\n\\nVisit us: ${settings.websiteUrl}`;
            }
            const tgUrl = `https://t.me/share/url?url=${encodeURIComponent(' ')}&text=${encodeURIComponent(message)}`;
            window.open(tgUrl, '_blank');
        }, 500);
    };

    const handlePrint = async () => {
        setIsGeneratingPdf(true);
        try {
            const blob = await pdf(<InvoicePDF invoice={currentInvoice} settings={settings} />).toBlob();
            const url = URL.createObjectURL(blob);
            const printWindow = window.open(url, '_blank');
            if (printWindow) {
                printWindow.onload = () => {
                    printWindow.print();
                };
            }
        } catch (error) {
            console.error('PDF generation error:', error);
            alert('Failed to generate PDF for printing');
        } finally {
            setIsGeneratingPdf(false);
        }
    };

    const handleDownload = async () => {
        setIsGeneratingPdf(true);
        try {
            const blob = await pdf(<InvoicePDF invoice={currentInvoice} settings={settings} />).toBlob();
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `invoice-${invoiceNo}.pdf`;
            link.click();
            URL.revokeObjectURL(url);
        } catch (error) {
            console.error('PDF generation error:', error);
            alert('Failed to generate PDF for download');
        } finally {
            setIsGeneratingPdf(false);
        }
    };

    const handleClear = () => {
        if (confirm('Are you sure you want to clear customer details and items?')) {
            setCustomer({ name: '', address: '', gstin: '', mobile: '' });
            setItems([{ ...initialItem, id: Date.now().toString() }]);
            setPayment(initialPayment);
            setPreviousBalance(0);
            setInvoiceNo(prev => {
                const num = parseInt(prev.split('-')[1]) + 1;
                return `INV-${num.toString().padStart(3, '0')}`;
            });
        }
    };

    const handleThermalPrint = (width: '33mm' | '58mm') => {
        const printWindow = window.open('', '_blank', `width=400,height=600`);
        if (printWindow) {
            const content = `
        <html>
          <head>
            <title>Print Receipt</title>
            <style>
              body { margin: 0; padding: 0; }
              @media print {
                @page { margin: 0; size: auto; }
                body { margin: 0; }
              }
            </style>
          </head>
          <body>
            <div id="root"></div>
          </body>
        </html>
      `;
            printWindow.document.write(content);
            printWindow.document.close();

            const html = `
        <div style="width: ${width}; font-family: monospace; font-size: ${width === '33mm' ? '10px' : '12px'}; padding: 5px; margin: 0 auto;">
          <div style="text-align: center; border-bottom: 1px dashed black; padding-bottom: 5px; margin-bottom: 10px;">
            <div style="font-weight: bold; font-size: 1.2em;">${settings.shopName}</div>
            <div>${settings.address}</div>
            <div>Mob: ${settings.mobile}</div>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
             <span>Inv: ${invoiceNo}</span>
             <span>${invoiceDate}</span>
          </div>
          <div style="margin-bottom: 5px;">Name: ${customer.name}</div>
          <div style="border-bottom: 1px dashed black; margin-bottom: 5px;"></div>
          <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px;">
            <thead>
              <tr style="text-align: left; border-bottom: 1px dashed black;">
                <th style="width: 50%">Item</th>
                <th style="width: 15%; text-align: center">Qty</th>
                <th style="width: 35%; text-align: right">Amt</th>
              </tr>
            </thead>
            <tbody>
              ${items.map(item => `
                <tr>
                  <td style="padding-right: 2px;">${item.name}</td>
                  <td style="text-align: center;">${item.quantity}</td>
                  <td style="text-align: right;">${formatCurrency(item.amount).replace('â‚¹', '')}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
          <div style="border-top: 1px dashed black; padding-top: 5px;">
             <div style="display: flex; justify-content: space-between;">
                <span>Total:</span>
                <span style="font-weight: bold;">${formatCurrency(grandTotal)}</span>
             </div>
             <div style="display: flex; justify-content: space-between;">
                <span>Due:</span>
                <span style="font-weight: bold;">${formatCurrency(totalDue)}</span>
             </div>
          </div>
          <div style="text-align: center; margin-top: 15px; font-size: 0.9em;">
            <div>${settings.customFooterMessage}</div>
            <div style="margin-top: 5px;">*** Thank You ***</div>
          </div>
        </div>
      `;

            printWindow.document.body.innerHTML = html;
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
            <div className="flex gap-1.5">
                <Input
                    label="Invoice No"
                    value={invoiceNo}
                    onChange={(e) => setInvoiceNo(e.target.value)}
                    className="w-32"
                />
                <Input
                    type="date"
                    label="Date"
                    value={invoiceDate}
                    onChange={(e) => setInvoiceDate(e.target.value)}
                />
            </div>
                    </div >
                </div >

    {/* Customer Details */ }
    < div className = "grid grid-cols-1 md:grid-cols-2 gap-6 mb-8" >
                    <div className="space-y-4">
                        <h3 className="font-semibold text-gray-700 dark:text-gray-300">Customer Details</h3>
                        <Input
                            placeholder="Customer Name"
                            value={customer.name}
                            onChange={(e) => setCustomer({ ...customer, name: e.target.value })}
                        />
                        <Input
                            placeholder="Address"
                            value={customer.address}
                            onChange={(e) => setCustomer({ ...customer, address: e.target.value })}
                        />
                        <div className="grid grid-cols-2 gap-4">
                            <Input
                                placeholder="GSTIN"
                                value={customer.gstin}
                                onChange={(e) => setCustomer({ ...customer, gstin: e.target.value })}
                            />
                            <Input
                                placeholder="Mobile"
                                value={customer.mobile}
                                onChange={(e) => setCustomer({ ...customer, mobile: e.target.value })}
                            />
                        </div>
                    </div>

                    <div className="space-y-4 bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl border dark:border-gray-700">
                        <h3 className="font-semibold text-gray-700 dark:text-gray-300">Payment & Status</h3>
                        <div className="grid grid-cols-2 gap-4">
                            <Input
                                label="Previous Balance"
                                type="number"
                                placeholder="0.00"
                                value={previousBalance}
                                onChange={(e) => setPreviousBalance(Number(e.target.value))}
                            />
                            <Input
                                label="Paid Amount"
                                type="number"
                                placeholder="0.00"
                                value={payment.paidAmount}
                                onChange={(e) => setPayment({ ...payment, paidAmount: Number(e.target.value) })}
                            />
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <Input
                                label="Due Date"
                                type="date"
                                value={payment.dueDate}
                                onChange={(e) => setPayment({ ...payment, dueDate: e.target.value })}
                            />
                            <div className="flex flex-col gap-1.5">
                                <label className="text-sm font-medium text-gray-700 dark:text-gray-300">Status</label>
                                <div className={`h-10 flex items-center px-3 rounded-md font-bold border ${status === 'PAID' ? 'bg-green-100 text-green-700 border-green-200' :
                                    status === 'PARTIAL' ? 'bg-yellow-100 text-yellow-700 border-yellow-200' :
                                        'bg-red-100 text-red-700 border-red-200'
                                    }`}>
                                    {status}
                                </div>
                            </div>
                        </div>
                    </div>
                </div >

    {/* Items Table */ }
    < div className = "mb-8" >
                    <div className="rounded-lg border dark:border-gray-700 overflow-visible">
                        <div className="overflow-visible">
                            <table className="w-full text-sm text-left">
                                <thead className="text-xs text-gray-700 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-700">
                                    <tr>
                                        <th className="px-4 py-3 rounded-tl-lg">Item Name</th>
                                        <th className="px-4 py-3 w-24">Qty</th>
                                        <th className="px-4 py-3 w-32">Rate</th>
                                        <th className="px-4 py-3 w-24">Disc %</th>
                                        {settings.showGST && <th className="px-4 py-3 w-24">GST %</th>}
                                        <th className="px-4 py-3 w-32">Amount</th>
                                        <th className="px-4 py-3 w-16 rounded-tr-lg"></th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-200 dark:divide-gray-700">
                                    {items.map((item, index) => (
                                        <tr key={item.id} className="border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 relative transition-colors">
                                            <td className="px-4 py-2 relative">
                                                <input
                                                    className="w-full bg-transparent focus:outline-none dark:text-white placeholder-gray-400"
                                                    placeholder="Item description"
                                                    value={item.name}
                                                    onChange={(e) => handleItemChange(index, 'name', e.target.value)}
                                                    onKeyDown={(e) => handleKeyDown(e, index)}
                                                    autoComplete="off"
                                                />
                                                {/* Autosuggest Dropdown */}
                                                {suggestions[index] && suggestions[index].length > 0 && (
                                                    <div className="absolute z-50 left-0 top-full mt-1 w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-xl max-h-60 overflow-y-auto ring-1 ring-black ring-opacity-5">
                                                        {suggestions[index].map((s, i) => (
                                                            <div
                                                                key={s.id}
                                                                className={`px-4 py-2 cursor-pointer text-sm border-b last:border-b-0 border-gray-100 dark:border-gray-700
                                                                ${i === selectedSuggestionIndex
                                                                        ? 'bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-200'
                                                                        : 'hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200'
                                                                    }`}
                                                                onClick={() => selectSuggestion(index, s)}
                                                            >
                                                                <div className="font-medium flex justify-between">
                                                                    <span>{s.name}</span>
                                                                    <span className="text-xs opacity-70">â‚¹{s.rate}</span>
                                                                </div>
                                                                <div className="text-xs text-gray-500 dark:text-gray-400">Stock: {s.stock ?? 0}</div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </td>
                                            <td className="px-4 py-2">
                                                <input
                                                    type="number"
                                                    className="w-full bg-transparent focus:outline-none dark:text-white placeholder-gray-400 transition-all"
                                                    placeholder="0"
                                                    value={item.quantity}
                                                    onChange={(e) => handleItemChange(index, 'quantity', e.target.value)}
                                                />
                                            </td>
                                            <td className="px-4 py-2">
                                                <input
                                                    type="number"
                                                    className="w-full bg-transparent focus:outline-none dark:text-white placeholder-gray-400 transition-all"
                                                    placeholder="0.00"
                                                    value={item.rate}
                                                    onChange={(e) => handleItemChange(index, 'rate', e.target.value)}
                                                />
                                            </td>
                                            <td className="px-4 py-2">
                                                <input
                                                    type="number"
                                                    className="w-full bg-transparent focus:outline-none dark:text-white placeholder-gray-400 transition-all"
                                                    placeholder="0"
                                                    value={item.discount}
                                                    onChange={(e) => handleItemChange(index, 'discount', e.target.value)}
                                                />
                                            </td>
                                            {settings.showGST && (
                                                <td className="px-4 py-2">
                                                    <input
                                                        type="number"
                                                        className="w-full bg-transparent focus:outline-none dark:text-white placeholder-gray-400 transition-all"
                                                        placeholder="0"
                                                        value={item.gst}
                                                        onChange={(e) => handleItemChange(index, 'gst', e.target.value)}
                                                    />
                                                </td>
                                            )}
                                            <td className="px-4 py-2 font-medium dark:text-white bg-gray-50 dark:bg-gray-700/30">
                                                <span className="text-gray-400 dark:text-gray-500 text-xs">â‚¹</span> {formatCurrency(item.amount).replace('â‚¹', '')}
                                            </td>
                                            <td className="px-4 py-2 text-center">
                                                <button
                                                    onClick={() => removeItem(index)}
                                                    className="text-red-500 hover:text-red-700 transition-all duration-200 hover:scale-110"
                                                >
                                                    <Trash2 size={18} />
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div className="mt-4">
                        <Button onClick={addItem} variant="outline" size="sm" className="gap-2 transition-all duration-200 hover:scale-105">
                            <Plus size={16} /> Add Item
                        </Button>
                    </div>
                </div >

    {/* Footer Totals */ }
    < div className = "flex justify-end border-t dark:border-gray-700 pt-4" >
        <div className="w-64 space-y-2">
            <div className="flex justify-between text-sm dark:text-gray-300">
                <span className="text-gray-600 dark:text-gray-400">Subtotal</span>
                <span>{formatCurrency(subTotal)}</span>
            </div>
            <div className="flex justify-between text-sm dark:text-gray-300">
                <span className="text-gray-600 dark:text-gray-400">Total GST</span>
                <span>{formatCurrency(totalGST)}</span>
            </div>
            <div className="flex justify-between text-lg font-bold border-t dark:border-gray-700 pt-2 mt-2 dark:text-white">
                <span>Grand Total</span>
                <span>{formatCurrency(grandTotal)}</span>
            </div>
            <div className="flex justify-between text-sm text-red-600 dark:text-red-400 font-medium">
                <span>Balance Due</span>
                <span>{formatCurrency(totalDue)}</span>
            </div>
        </div>
                </div >

    <div className="mt-8 flex justify-between items-center gap-4">
        <div className="flex gap-2">
            <Button variant="outline" onClick={() => handleThermalPrint('33mm')} size="sm" className="transition-all duration-200 hover:scale-105">
                <Printer size={16} className="mr-1" /> 33mm
            </Button>
            <Button variant="outline" onClick={() => handleThermalPrint('58mm')} size="sm" className="transition-all duration-200 hover:scale-105">
                <Printer size={16} className="mr-1" /> 58mm
            </Button>
            <Button variant="outline" onClick={handleExportCSV} size="sm" className="gap-2 transition-all duration-200 hover:scale-105">
                <Download size={16} /> CSV
            </Button>
        </div>
        <div className="flex gap-2">
            {/* Print Button - Direct Print */}
            <Button
                onClick={handlePrint}
                className="gap-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 transition-all duration-200 hover:scale-105 hover:shadow-lg"
                disabled={isGeneratingPdf}
            >
                <Printer size={18} /> {isGeneratingPdf ? 'Generating...' : 'Print'}
            </Button>

            {/* Download Button */}
            <Button
                onClick={handleDownload}
                className="gap-2 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 transition-all duration-200 hover:scale-105 hover:shadow-lg"
                disabled={isGeneratingPdf}
            >
                <Download size={18} /> {isGeneratingPdf ? 'Generating...' : 'Download'}
            </Button>

            {/* WhatsApp Button - Download + Open */}
            <Button
                onClick={handleWhatsApp}
                className="gap-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white transition-all duration-200 hover:scale-105 hover:shadow-lg"
            >
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
                </svg>
                WhatsApp
            </Button>

            {/* Telegram Button - Download + Open */}
            <Button
                onClick={handleTelegram}
                className="gap-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white transition-all duration-200 hover:scale-105 hover:shadow-lg"
            >
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" />
                </svg>
                Telegram
            </Button>
        </div>
    </div>

{/* Company Branding Footer */ }
<div className="mt-6 pt-4 border-t dark:border-gray-700 text-center text-xs text-gray-500 dark:text-gray-400">
    <p>Â© {new Date().getFullYear()} All Rights Reserved</p>
    <p className="mt-1">Powered by <span className="font-semibold text-blue-600 dark:text-blue-400">QYNEX CORE SOFTECH</span></p>
</div>
            </div >
    {/* Close content wrapper */ }
        </div >
        </div >
    );
};
